<!doctype html>
<html lang="en-US">
<head>
	<title>Capital Market Insights</title>
	 
	 <meta charset="utf-8">
	 <meta name="viewport" content="width=device-width, initial-scale=1">   
		<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.js"> </script>
		<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.min.js"> </script>
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		
		<link href="../stylesheets/bootstrap.min.css"  rel="stylesheet">
		<script src="../javascript/jquery-1.11.1.min.js"> </script>
		<script src=""> </script>
		<script type="text/javascript" src="/node_modules/xmltojson/lib/xmlToJSON.js"></script>
  
		<link rel="stylesheet" href="/stylesheets/MyChatbotStyle.css">
	
</head>



<body class="bg" ng-app="myApp" ng-controller="mycontroller">
	<div class = "container">

	</div>
	<nav class="navbar navbar-inverse">
	  <div class="container-fluid">
		<div class="navbar-header">
		  <a class="navbar-brand" href="#">Capital Market Insights</a>
		</div>
		<ul class="nav navbar-nav">
		  <li class="active"><a href="#">Home</a></li>
		  
		 <li> 
			<form  class="navbar-form navbar-left">
			<div class="input-group">
			<input style="width : 300px; " type="text" class="form-control" placeholder="Search">
			<div class="input-group-btn">
			<button class="btn btn-default" type="submit">
			<i class="glyphicon glyphicon-search"></i>
			</button>
			</div>
			</div>
			</form>
		</li>
		<li><a href="#">About Us</a></li>
		  <li><a href="#">Contact</a></li>
		</ul>
		
	  </div>
	</nav>


	<div class="container-fluid ">
	  
	  <div class="row">
		 <div class="col-lg-3"  style="position:relative;  top : 68px; left : 6px;">

    <div class="panel panel-default">
       
        <div class="panel-body">
            <!-- TREEVIEW CODE -->
            <ul class="treeview">
                <li><a href="#">Navigate Result</a>
                	<ul>
            			<li><a href="#">JPMorgan Chase</a>
						<ul>
							<li><a href="#">Financial Results</a>
								<ul>
								<li><a href="#">Q1 2017</a></li>
								<li><a href="#">Q4 2016</a></li>
								<li><a href="#">Q3 2016</a></li>
								<li><a href="#">Q1 2016</a></li>
								<li><a href="#">Q2 2016</a></li>
								</ul>
							</li>
							<li><a href="#">Upcoming Events</a></li>
							<li><a href="#">Press Releases</a></li>
						</ul>
						</li>
						
            			<li><a href="#">Bank Of America</a>
					    <ul>
							<li><a href="#">Financial Results</a>
								<ul>
								<li><a href="#">Q1 2017</a></li>
								<li><a href="#">Q4 2016</a></li>
								<li><a href="#">Q3 2016</a></li>
								<li><a href="#">Q1 2016</a></li>
								<li><a href="#">Q2 2016</a></li>
								</ul>
							</li>
							<li><a href="#">Upcoming Events</a></li>
							<li><a href="#">Press Releases</a></li>
						</ul>
						</li>
						
            			<li><a href="#">Goldman Sachs</a>
						<ul>
							<li><a href="#">Financial Results</a>
								<ul>
								<li><a href="#">Q1 2017</a></li>
								<li><a href="#">Q4 2016</a></li>
								<li><a href="#">Q3 2016</a></li>
								<li><a href="#">Q1 2016</a></li>
								<li><a href="#">Q2 2016</a></li>
								</ul>
							</li>
							<li><a href="#">Upcoming Events</a></li>
							<li><a href="#">Press Releases</a></li>
						</ul>
						</li>
						
            		</ul>
            	</li>
            </ul>
        </div>
    </div>
 


	</div>
	  
		<div class="col-lg-6" >
		<h1 align="center" style="color : white;"> Search Result </h1>

		<div style=" max-height:500px; overflow-y: hidden;"> 
	  <div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		<div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		<div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		
		<div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		
		<div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		
		<div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		
		<div class="panel panel-primary">
		  <div class="panel-heading">https://www.jpmorganchase.com:80/corporate/investor-relations/document/4Q16_Earnings_Presentation.pdf</div>
		  <div class="panel-body">Some details returned in API call</div>
		</div>
		
	  </div>
		
	  </div>
		
		</div>
	</div>

	<div class="chaticon">
	<div class="container text-center">
		<div class="row">
			
			<div class="round hollow text-center">
			<a href="#" id="addClass"><span class="glyphicon glyphicon-comment"></span> Any Query? </a>
			</div>        
		</div>
	</div>
	</div>


	<div class="popup-box chat-popup" id="qnimate">
				<div class="popup-head">
					<div class="popup-head-left pull-left"><img src="../images/chatbot.jpg" alt="IamChatBot"> Chat-Bot</div>
						  <div class="popup-head-right pull-right">
							<button data-widget="remove" id="removeClass" class="chat-header-button pull-right" type="button"><i class="glyphicon glyphicon-off"></i></button>
						  </div>
					</div>
				  
				<div class="popup-messages">
				<div class="direct-chat-messages">
						
						
						
						<!-- Message. Default to the left -->
					   
						<div>
							<div class="direct-chat-info clearfix">
							<span class="direct-chat-name pull-left">Chat-Bot</span>
							</div>
						 
						  <img alt="message user image" src="../images/chatbot.jpg" class="direct-chat-img">
						  <div class="direct-chat-text" ng-repeat = "x in myData">
							<div ng-if = "x.text">
							<p> {{ x.text }}</p>
							</div>
							
							 <div ng-if = "x.question">
							<p> {{ x.question }}</p>
							</div>
							
						  </div>
						  <div class="direct-chat-info clearfix">
							<span class="direct-chat-timestamp pull-right"> {{CurrentDate | date:'hh:mm:ss a'}}</span>
						  </div>
						</div>
						
			</div>
			</div>
			
			<div class="popup-messages-footer">
				<input class = "chatbotinput" type="text" ng-keypress="($event.which === 13)?send1():0" ng-model="input.question" / > 
				<button class="button1" ng-click="send1()" > Send </button> 
				</div>
			
				
	</div>
		 
	</body>
	<script type="text/javascript">
	  $(function(){
	$("#addClass").click(function () {
			  $('#qnimate').addClass('popup-box-on');
				});
			  
				$("#removeClass").click(function () {
			  $('#qnimate').removeClass('popup-box-on');
				});
	  })
	</script>
	
	<script>
		var app = angular.module("myApp",  ["ngRoute"]);
		app.controller('mycontroller', function($scope,$http) {
	
		$scope.result = [];
			
		//xml to json converstion
			$http.get("/restWEX").then(function (response) {	
				 var result = xmlToJSON.parseString(response.data);					
				for(var i=0 ; i< result['query-results'][0].list[0].document.length ; i++)
					{
					 console.log(result['query-results'][0].list[0].document[i]._attr.url._value);											
						$scope.result.push({'url' : result['query-results'][0].list[0].document[i]._attr.url._value, 'text' : result['query-results'][0].list[0].document[i].content[3]._text});
					}
				console.log($scope.result);
					
				});
				
			
			
			
			console.log("controller is hit");
			$scope.myData = [];
			$http.get('/cmfirstcall').then(function(response){
					$scope.myData.push(response.data);
					console.log("response received");
					
			});
			
			$scope.send1 = function(){
				console.log($scope.input.question);
			$scope.myData.push({"question" : $scope.input.question});
			//$scope.input.question = " ";
			$http.post('/cmconsecutivecalls',$scope.input).then(function(response){
						$scope.input.question = " ";
					$scope.myData.push(response.data);
					console.log(response.data);
					
			});
			}
			
			$scope.send2 = function(){
			$scope.tweetdata = [] ;
			$http.post('/accessTweets',$scope.input).then(function(response){
						$scope.input.query = " ";
					
					var data = "";
					for(var i=0 ; i< response.data.length ; i++)
					{
					 data = data + JSON.stringify(response.data[i].text) + "/n";
					}
					console.log(data);
					$scope.tweetdata.push(data);
					
			});
			}
			$scope.formatXml = function (xml) {
		        var reg = /(>)(<)(\/*)/g;
		        var wsexp = / *(.*) +\n/g;
		        var contexp = /(<.+>)(.+\n)/g;
		        xml = xml.replace(reg, '$1\n$2$3').replace(wsexp, '$1\n').replace(contexp, '$1\n$2');
		        var pad = 0;
		        var formatted = '';
		        var lines = xml.split('\n');
		        var indent = 0;
		        var lastType = 'other';
		        // 4 types of tags - single, closing, opening, other (text, doctype, comment) - 4*4 = 16 transitions 
		        var transitions = {
		            'single->single': 0,
		            'single->closing': -1,
		            'single->opening': 0,
		            'single->other': 0,
		            'closing->single': 0,
		            'closing->closing': -1,
		            'closing->opening': 0,
		            'closing->other': 0,
		            'opening->single': 1,
		            'opening->closing': 0,
		            'opening->opening': 1,
		            'opening->other': 1,
		            'other->single': 0,
		            'other->closing': -1,
		            'other->opening': 0,
		            'other->other': 0
		        };

		        for (var i = 0; i < lines.length; i++) {
		            var ln = lines[i];
		            var single = Boolean(ln.match(/<.+\/>/)); // is this line a single tag? ex. <br />
		            var closing = Boolean(ln.match(/<\/.+>/)); // is this a closing tag? ex. </a>
		            var opening = Boolean(ln.match(/<[^!].*>/)); // is this even a tag (that's not <!something>)
		            var type = single ? 'single' : closing ? 'closing' : opening ? 'opening' : 'other';
		            var fromTo = lastType + '->' + type;
		            lastType = type;
		            var padding = '';

		            indent += transitions[fromTo];
		            for (var j = 0; j < indent; j++) {
		                padding += '\t';
		            }
		            if (fromTo == 'opening->closing')
		                formatted = formatted.substr(0, formatted.length - 1) + ln + '\n'; // substr removes line break (\n) from prev loop
		            else
		                formatted += padding + ln + '\n';
		        }

		        return formatted;
		    };
			
		});
	</script>
	
<script>
//for list tree 
$.fn.extend({
	treeview:	function() {
		return this.each(function() {
			// Initialize the top levels;
			var tree = $(this);
			
			tree.addClass('treeview-tree');
			tree.find('li').each(function() {
				var stick = $(this);
			});
			tree.find('li').has("ul").each(function () {
				var branch = $(this); //li with children ul
				
				branch.prepend("<i class='tree-indicator glyphicon glyphicon-chevron-right'></i>");
				branch.addClass('tree-branch');
				branch.on('click', function (e) {
					if (this == e.target) {
						var icon = $(this).children('i:first');
						
						icon.toggleClass("glyphicon-chevron-down glyphicon-chevron-right");
						$(this).children().children().toggle();
					}
				})
				branch.children().children().toggle();
				
				
				branch.children('.tree-indicator, button, a').click(function(e) {
					branch.click();
					
					e.preventDefault();
				});
			});
		});
	}
});


$(window).on('load', function () {
	$('.treeview').each(function () {
		var tree = $(this);
		tree.treeview();
	})
})
</script>
</html> 
